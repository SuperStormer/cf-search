{"version":3,"file":"index.js","mappings":"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","sources":["webpack://cf-search/./src/scripts/consts.js","webpack://cf-search/./src/scripts/utils.js","webpack://cf-search/./src/scripts/api.js","webpack://cf-search/./src/scripts/dropdowns.js","webpack://cf-search/./src/scripts/filters.js","webpack://cf-search/./src/scripts/results.js","webpack://cf-search/./src/scripts/index.js"],"sourcesContent":["// I'm assuming this is safe b/c ferium does the same thing ¯\\_(ツ)_/¯\n// https://github.com/gorilla-devs/ferium/blob/f9bf7906fde4938255bd4e9d95a680ac5646c0b4/src/main.rs#L95\nexport const API_KEY = \"$2a$10$3kFa9lBWciEK.lsp7NyCSupZ3XmlAYixZQ9fTczqsz1/.W9QDnLUy\";\nexport const GAME_ID = 432;\nexport const MODLOADERS = [[\"Any\", 0], [\"Forge\", 1], [\"Fabric\", 4], [\"Quilt\", 5], [\"NeoForge\", 6]];\nexport const SORT_FIELDS = [\n\t\"Featured\",\n\t\"Popularity\",\n\t\"Last Updated\",\n\t\"Name\",\n\t\"Author\",\n\t\"Total Downloads\",\n\t\"Category\",\n\t\"Game Version\",\n].map((v, i) => [v, i + 1]);\nexport const SORT_ORDERS = [\"asc\", \"desc\"].map((v) => [v, v]);\n","/* utility functions */\n// https://stackoverflow.com/a/34890276\nexport function group_by(xs, key) {\n\treturn xs.reduce(function (rv, x) {\n\t\t(rv[x[key]] = rv[x[key]] || []).push(x);\n\t\treturn rv;\n\t}, {});\n}\n\n// https://stackoverflow.com/a/50636286\nexport function partition(array, filter) {\n\tlet pass = [],\n\t\tfail = [];\n\tarray.forEach((e, idx, arr) => (filter(e, idx, arr) ? pass : fail).push(e));\n\treturn [pass, fail];\n}\n\n// based on https://stackoverflow.com/a/4499062\nexport function human_readable(number) {\n\tif (number < 1000) {\n\t\treturn number.toString();\n\t} else if (number < 1000 * 1000) {\n\t\treturn (number / 1000).toFixed(1) + \"K\";\n\t} else {\n\t\treturn (number / 1000 / 1000).toFixed(1) + \"M\";\n\t}\n}\n\nexport function natural_compare(a, b) {\n\treturn a.localeCompare(b, \"en\", { numeric: true });\n}\n\nexport function sort_classes(array) {\n\treturn array.sort((a, b) => natural_compare(a.name, b.name));\n}\n\nexport function format_categories(array, class_id) {\n\tlet subcategories = group_by(array, \"parentCategoryId\");\n\tlet top_level = subcategories[class_id];\n\tdelete subcategories[class_id];\n\n\ttop_level.sort((a, b) => natural_compare(a.name, b.name));\n\n\tfor (let [id, subcategory] of Object.entries(subcategories)) {\n\t\tid = parseInt(id, 10);\n\t\tsubcategory.sort((a, b) => natural_compare(a.name, b.name));\n\t\tsubcategory.forEach((x) => {\n\t\t\tx.name = \" └ \" + x.name;\n\t\t});\n\n\t\t// insert subcategories below top level category\n\t\tlet i = top_level.findIndex((x) => x.id === id);\n\t\ttop_level.splice(i + 1, 0, ...subcategory);\n\t}\n\treturn top_level;\n}\n\nexport function sort_vers(versions) {\n\treturn versions\n\t\t.filter((x) => x.name.startsWith(\"Minecraft\")) //TODO figure out why other versions don't work and remove this temp fix\n\t\t.sort((a, b) => {\n\t\t\ta = a.name;\n\t\t\tb = b.name;\n\t\t\tif (a.startsWith(\"Minecraft\")) {\n\t\t\t\tif (b.startsWith(\"Minecraft\")) {\n\t\t\t\t\tif (a === \"Minecraft Beta\") {\n\t\t\t\t\t\treturn 1;\n\t\t\t\t\t} else if (b === \"Minecraft Beta\") {\n\t\t\t\t\t\treturn -1;\n\t\t\t\t\t}\n\n\t\t\t\t\treturn -natural_compare(a, b);\n\t\t\t\t}\n\t\t\t\treturn -1;\n\t\t\t}\n\t\t\tif (b.startsWith(\"Minecraft\")) {\n\t\t\t\treturn 1;\n\t\t\t}\n\t\t\treturn natural_compare(a, b);\n\t\t});\n}\n\nexport function sort_subvers(subvers) {\n\treturn subvers.sort((a, b) => {\n\t\tif (a.endsWith(\"Snapshot\")) {\n\t\t\treturn 1;\n\t\t} else if (b.endsWith(\"Snapshot\")) {\n\t\t\treturn -1;\n\t\t}\n\t\treturn -natural_compare(a, b);\n\t});\n}\n","import { API_KEY } from \"./consts\";\nexport async function cf_api(endpoint, params, additional_args) {\n\tif (typeof params === \"object\" && !(params instanceof URLSearchParams)) {\n\t\tparams = new URLSearchParams(params);\n\t} else if (params == undefined) {\n\t\tparams = \"\";\n\t}\n\n\tif (endpoint.startsWith(\"/\")) {\n\t\tendpoint = endpoint.slice(1);\n\t}\n\n\treturn fetch(\"https://api.curseforge.com/\" + endpoint + \"?\" + params, {\n\t\theaders: { \"x-api-key\": API_KEY, accept: \"application/json\" },\n\t\t...additional_args,\n\t})\n\t\t.then((resp) => resp.json())\n\t\t.then((json) => json.data);\n}\n","import { sort_classes, group_by, format_categories, sort_vers } from \"./utils\";\nimport { GAME_ID } from \"./consts\";\nimport { cf_api } from \"./api\";\n\n/* populate dropdowns */\nexport function populate_dropdown(dropdown, values, defaultValue) {\n\tdropdown.innerHTML = \"\";\n\tlet fragment = document.createDocumentFragment();\n\n\tfor (let [name, value] of values) {\n\t\tlet option = document.createElement(\"option\");\n\t\toption.value = value;\n\t\toption.textContent = name;\n\t\tfragment.append(option);\n\t}\n\n\tdropdown.append(fragment);\n\n\tif (defaultValue == undefined) {\n\t\t// if no default value is specified, create a default option with the category name\n\t\t// based on https://stackoverflow.com/a/8442831\n\t\tlet defaultOption = document.createElement(\"option\");\n\t\tdefaultOption.value = \"\";\n\t\tdefaultOption.selected = true;\n\t\tdefaultOption.textContent = dropdown.dataset.name;\n\t\tdropdown.dataset.default = \"\";\n\t\tdropdown.prepend(defaultOption);\n\t} else {\n\t\t// otherwise, select the corresponding <option>\n\t\tlet option = Array.from(dropdown.options).find((x) => x.textContent === defaultValue);\n\t\tdropdown.dataset.default = option.value;\n\t\toption.selected = true;\n\t\tdropdown.dispatchEvent(new Event(\"change\"));\n\t}\n}\n\n/* fetch dropdown values from CF API */\nasync function fetch_categories() {\n\tlet categories = await cf_api(\"/v1/categories\", { gameId: GAME_ID });\n\tcategories = group_by(categories, \"classId\");\n\n\tlet classes = sort_classes(categories[undefined]);\n\tdelete categories[undefined];\n\n\t// ignore bukkit plugins, customizations, addons, shaders\n\t// API doesn't work and I don't feel like figuring out why\n\tlet broken_classes = [5, 4546, 4559, 4979, 6552];\n\tfor (let id of broken_classes) {\n\t\tdelete categories[id];\n\t}\n\tclasses = classes.filter((x) => !broken_classes.includes(x.id));\n\n\t// format categories\n\tfor (let class_ in categories) {\n\t\tcategories[class_] = format_categories(categories[class_], class_);\n\t}\n\n\t// ignore Fabric, FancyMenu, QoL, Vanilla+ tags\n\t// these tags don't exist anymore, idk why they're still in the API\n\tlet broken_mod_categories = [5192, 4780, 5190, 5129];\n\tcategories[6] = categories[6].filter((x) => !broken_mod_categories.includes(x.id));\n\treturn [classes, categories];\n}\n\nasync function fetch_vers() {\n\treturn sort_vers(await cf_api(`/v1/games/${GAME_ID}/version-types`));\n}\n\nfunction fetch_subvers() {\n\treturn cf_api(`/v1/games/${GAME_ID}/versions`);\n}\n\n// fetch in parallel and cache\nexport async function fetch_dropdown_values() {\n\tlet cache_time = localStorage.getItem(\"cache_time\");\n\tlet now = Date.now();\n\tlet classes, categories, versions, sub_versions;\n\tif (!cache_time || now - cache_time > 24 * 60 * 60 * 1000) {\n\t\tlet result = await Promise.all([fetch_categories(), fetch_vers(), fetch_subvers()]);\n\t\t[[classes, categories], versions, sub_versions] = result;\n\t\tlocalStorage.setItem(\"cache\", JSON.stringify(result));\n\t\tlocalStorage.setItem(\"cache_time\", now);\n\t} else {\n\t\t[[classes, categories], versions, sub_versions] = JSON.parse(localStorage.getItem(\"cache\"));\n\t}\n\treturn [classes, categories, versions, sub_versions];\n}\n","/* handle visual filters */\nimport { natural_compare, partition } from \"./utils\";\nexport function populate_filters(filters_el, categories, checked_callback) {\n\tfilters_el.innerHTML = \"\";\n\tlet fragment = document.createDocumentFragment();\n\n\tfor (let [category, id] of categories) {\n\t\tlet el = document.createElement(\"label\");\n\t\tel.className = \"checkbox-label\";\n\n\t\tlet checkbox = document.createElement(\"input\");\n\t\tcheckbox.type = \"checkbox\";\n\t\tcheckbox.name = category;\n\t\tcheckbox.value = id;\n\n\t\tcheckbox.addEventListener(\"change\", function (event) {\n\t\t\t// custom checkbox behavior for filters\n\t\t\t// cycle from off, include, exclude\n\t\t\tlet el = event.target;\n\t\t\tif (!el.dataset.value || el.dataset.value === \"off\") {\n\t\t\t\t// off -> include\n\t\t\t\tel.checked = true;\n\t\t\t\tel.indeterminate = false;\n\t\t\t\tel.dataset.value = \"include\";\n\t\t\t} else if (el.dataset.value === \"include\") {\n\t\t\t\t// include -> exclude\n\t\t\t\tel.indeterminate = true;\n\t\t\t\tel.checked = true;\n\t\t\t\tel.dataset.value = \"exclude\";\n\t\t\t} else {\n\t\t\t\t// exclude -> off\n\t\t\t\tel.checked = false;\n\t\t\t\tel.indeterminate = false;\n\t\t\t\tel.dataset.value = \"off\";\n\t\t\t}\n\n\t\t\t// handle filtering\n\t\t\tchecked_callback();\n\t\t});\n\n\t\tlet label = document.createTextNode(category);\n\t\tel.append(checkbox, label);\n\t\tfragment.append(el);\n\t}\n\n\tfilters_el.append(fragment);\n}\n\nexport function get_active_filters(filters_el, version_filters_els) {\n\tlet filters = Array.from(filters_el.elements).filter((x) => x.checked);\n\tlet [include, exclude] = partition(filters, (x) => x.dataset.value === \"include\");\n\t[include, exclude] = [\n\t\tinclude.map((x) => parseInt(x.value, 10)),\n\t\texclude.map((x) => parseInt(x.value, 10)),\n\t];\n\n\tlet [min_ver, max_ver] = Array.from(version_filters_els).map((x) => x.value);\n\n\treturn [include, exclude, max_ver, min_ver];\n}\n\nexport function filter_results(results, filters) {\n\tlet [include, exclude, max_ver, min_ver] = filters;\n\t// handle includes\n\tif (include.length > 0) {\n\t\tresults = results.filter((result) =>\n\t\t\tinclude.every((id) => result.categories.find((category) => category.id == id))\n\t\t);\n\t}\n\n\t//handle excludes\n\tif (exclude.length > 0) {\n\t\tresults = results.filter((result) =>\n\t\t\tresult.categories.every((category) => !exclude.includes(category.id))\n\t\t);\n\t}\n\n\t//handle max ver\n\tif (max_ver.length > 0) {\n\t\tif (max_ver.split(\".\").length === 2) {\n\t\t\t// only major version provided (eg. \"1.12\"),\n\t\t\t// so we add a string that will always compare greater than all of the subvers for that major ver\n\t\t\tmax_ver += \"a\";\n\t\t}\n\t\tresults = results.filter((result) =>\n\t\t\tresult.latestFilesIndexes.some(\n\t\t\t\t(file) => natural_compare(file.gameVersion, max_ver) <= 0\n\t\t\t)\n\t\t);\n\t}\n\n\t//handle min ver\n\tif (min_ver.length > 0) {\n\t\tresults = results.filter((result) =>\n\t\t\tresult.latestFilesIndexes.some(\n\t\t\t\t(file) => natural_compare(file.gameVersion, min_ver) >= 0\n\t\t\t)\n\t\t);\n\t}\n\n\treturn results;\n}\n\nexport function update_query_params(params, filters) {\n\tlet params2 = new URLSearchParams(params);\n\t// don't overwrite filters query params\n\tlet [include, exclude, max_ver, min_ver] = filters;\n\tparams2.set(\"filtersInclude\", include.join(\" \"));\n\tparams2.set(\"filtersExclude\", exclude.join(\" \"));\n\tparams2.set(\"maxVer\", max_ver);\n\tparams2.set(\"minVer\", min_ver);\n\tif (window.location.search !== \"?\" + params2.toString()) {\n\t\thistory.pushState({}, \"\", \"?\" + params2.toString());\n\t}\n}\n","import { update_query_params, filter_results } from \"./filters\";\nimport { GAME_ID } from \"./consts\";\nimport { cf_api } from \"./api\";\nimport { human_readable, natural_compare } from \"./utils\";\n\nlet search_results = [];\n// prevent double update_results with an AbortController\nlet current_ac = null;\nexport let current_updating_event = \"\";\n\nexport async function update_results(\n\tresults_el,\n\tloading_indicator,\n\tform_data,\n\tfilters,\n\tpage,\n\tevent_name\n) {\n\tif (current_ac !== null) {\n\t\tcurrent_ac.abort();\n\t}\n\tcurrent_ac = new AbortController();\n\tcurrent_updating_event = event_name;\n\n\tlet params = new URLSearchParams(form_data);\n\n\t// update query params only if search parameters were modified\n\tif (current_updating_event == \"control_change\") {\n\t\tupdate_query_params(params, filters);\n\t}\n\n\tparams.append(\"gameId\", GAME_ID);\n\n\t// work-around for curseforge API being bad\n\tif (params.get(\"gameVersion\") && params.get(\"modLoaderType\") === \"0\") {\n\t\tparams.delete(\"modLoaderType\");\n\t}\n\n\tloading_indicator.hidden = false;\n\tresults_el.innerHTML = \"\";\n\n\tsearch_results = [];\n\ttry {\n\t\t// since CF API only lets us fetch 50 at a time,\n\t\t// this horrible code splits the desired pageSize into multiple requests\n\t\tlet queries = [];\n\t\tlet page_size = Number.parseInt(params.get(\"pageSize\"), 10);\n\n\t\tfor (let offset = 0; offset < page_size; offset += 50) {\n\t\t\tlet real_page_size = Math.min(50, page_size - offset);\n\t\t\tlet params2 = new URLSearchParams(params);\n\n\t\t\t// index is the index of the first item to include in the response\n\t\t\tlet index = page_size * page + offset;\n\n\t\t\tparams2.set(\"index\", index);\n\t\t\tparams2.set(\"pageSize\", real_page_size);\n\n\t\t\tqueries.push(cf_api(\"/v1/mods/search\", params2, { signal: current_ac.signal }));\n\t\t}\n\t\t// await each query sequentially to ensure result elements are properly ordered\n\t\tlet query_results = [];\n\t\tfor (let query of queries) {\n\t\t\tlet query_result = await query;\n\t\t\tconsole.log(query_result);\n\t\t\tpopulate_results(results_el, filters, query_result);\n\t\t\tquery_results.push(query_result);\n\t\t}\n\t\tsearch_results = query_results.flat();\n\n\t\tloading_indicator.hidden = true;\n\n\t\tcurrent_ac = null;\n\t\tcurrent_updating_event = null;\n\t} catch (error) {\n\t\tif (error.name !== \"AbortError\") {\n\t\t\tthrow error;\n\t\t}\n\t}\n}\n\nexport function populate_results(results_el, filters, results) {\n\tresults = filter_results(results, filters);\n\n\tlet params = new URLSearchParams(window.location.search);\n\n\tlet fragment = document.createDocumentFragment();\n\tfor (let result of results) {\n\t\tlet li = document.createElement(\"li\");\n\t\tli.className = \"result\";\n\n\t\t//title\n\t\tlet title = document.createElement(\"div\");\n\t\ttitle.className = \"result-title\";\n\n\t\tlet title_link = document.createElement(\"a\");\n\t\ttitle_link.className = \"result-title-link\";\n\t\t// replace hostname to fix #8\n\t\tlet title_url = new URL(result.links.websiteUrl);\n\t\ttitle_url.hostname = \"www.curseforge.com\";\n\t\ttitle_link.href = title_url;\n\t\ttitle_link.textContent = result.name;\n\t\ttitle.append(title_link);\n\n\t\t// check needed to fix #9\n\t\tif(result.authors.length > 0) {\n\t\t\tlet author = document.createElement(\"span\");\n\t\t\tauthor.className = \"result-author\";\n\t\t\tlet author_link = document.createElement(\"a\");\n\t\t\tauthor_link.className = \"result-author-link\";\n\t\t\tauthor_link.href = result.authors[0].url;\n\t\t\tauthor_link.textContent = result.authors[0].name;\n\t\t\tauthor.append(\"by\", author_link);\n\t\t\ttitle.append(author);\n\t\t}\n\n\t\t// subtitle\n\t\tlet subtitle = document.createElement(\"div\");\n\t\tsubtitle.className = \"result-subtitle\";\n\t\tlet downloads = document.createElement(\"span\");\n\t\tdownloads.textContent = `${human_readable(result.downloadCount)} Downloads`;\n\t\tlet updated = document.createElement(\"span\");\n\t\tupdated.textContent = `Updated ${new Date(result.dateModified).toLocaleDateString()}`;\n\t\tlet created = document.createElement(\"span\");\n\t\tcreated.textContent = `Created ${new Date(result.dateCreated).toLocaleDateString()}`;\n\t\tsubtitle.append(downloads, updated, created);\n\n\t\t// summary\n\t\tlet summary = document.createElement(\"p\");\n\t\tsummary.className = \"result-summary\";\n\t\tsummary.textContent = result.summary;\n\n\t\t// category images\n\t\tlet categories = document.createElement(\"div\");\n\t\tcategories.className = \"result-categories\";\n\t\tfor (let category of result.categories) {\n\t\t\t// TODO change link to change form param instead\n\t\t\tlet el = document.createElement(\"a\");\n\t\t\tel.href = category.url;\n\n\t\t\tlet img = document.createElement(\"img\");\n\t\t\timg.className = \"result-category-image\";\n\t\t\timg.src = category.iconUrl;\n\t\t\timg.title = category.name;\n\n\t\t\tel.append(img);\n\t\t\tcategories.append(el);\n\t\t}\n\n\t\t// project id\n\t\tlet id = document.createElement(\"span\");\n\t\tid.className = \"result-project-id\";\n\t\tid.textContent = `Project ID: ${result.id}`;\n\n\t\t// download button\n\t\tlet download = document.createElement(\"a\");\n\t\tdownload.className = \"download-button\";\n\t\tdownload.href = get_download_url(result, params);\n\t\tlet download_button = document.createElement(\"button\");\n\t\tdownload_button.textContent = \"Download\";\n\t\t// nesting an <button> within an <a> is technically invalid HTML5, but I don't care\n\t\tdownload.append(download_button);\n\n\t\t//logo\n\t\tlet logo = document.createElement(\"img\");\n\t\tlogo.className = \"result-logo\";\n\t\tif (result.logo) {\n\t\t\tlogo.src = result.logo.thumbnailUrl;\n\t\t}\n\t\tlogo.alt = \"\";\n\n\t\tli.append(logo, categories, download, id, title, subtitle, summary);\n\t\tfragment.append(li);\n\t}\n\tresults_el.append(fragment);\n}\n\nfunction get_download_url(result, params) {\n\tlet is_mod = params.get(\"classId\") === \"6\";\n\tlet is_modpack = params.get(\"classId\") === \"4471\";\n\tlet subver = params.get(\"gameVersion\");\n\tlet version = Number.parseInt(params.get(\"gameVersionTypeId\"), 10);\n\tlet modloader = Number.parseInt(params.get(\"modLoaderType\"), 10);\n\n\t// handle mods where version, subver and mod-loader are all set\n\t// otherwise file to download is ambigious (file for the wrong MC version will break)\n\tif (\n\t\tis_mod &&\n\t\tparams.get(\"gameVersion\") &&\n\t\tparams.get(\"gameVersionTypeId\") &&\n\t\tparams.has(\"modLoaderType\") &&\n\t\tparams.get(\"modLoaderType\") !== \"0\"\n\t) {\n\t\t// fabric didn't exist before 1.14, so a lot of the old files are untagged with mod loader\n\t\tlet is_old_forge = natural_compare(subver, \"1.14\") < 0 && modloader === 1;\n\n\t\ttry {\n\t\t\tlet file_id = result.latestFilesIndexes.find(\n\t\t\t\t(file) =>\n\t\t\t\t\tfile.gameVersionTypeId === version &&\n\t\t\t\t\tfile.gameVersion === subver &&\n\t\t\t\t\t(file.modLoader === modloader || (file.modLoader === null && is_old_forge))\n\t\t\t).fileId;\n\t\t\treturn `${result.links.websiteUrl}/download/${file_id}/file`;\n\t\t} catch (e) {\n\t\t\tif (e instanceof TypeError) {\n\t\t\t\tconsole.log(`${result.name} has improperly tagged files`);\n\t\t\t}\n\t\t\t// fall through\n\t\t}\n\t} else if (is_modpack) {\n\t\t// handle all modpacks\n\t\t// if subver is unset, fallback to latest from the version\n\t\t// if ver is unset, fallback to latest file from any MC version.\n\t\t// This is safe, because downloading a pack for a random MC version *won't* cause conflicts,\n\t\t// unlike mods, resourcepacks, or worlds where a file for the wrong MC version will break something.\n\t\ttry {\n\t\t\tlet file_id = result.latestFilesIndexes.find(\n\t\t\t\t(file) =>\n\t\t\t\t\t(Number.isNaN(version) || file.gameVersionTypeId === version) &&\n\t\t\t\t\t(subver === \"\" || file.gameVersion === subver)\n\t\t\t).fileId;\n\t\t\treturn `${result.links.websiteUrl}/download/${file_id}/file`;\n\t\t} catch (e) {\n\t\t\tif (e instanceof TypeError) {\n\t\t\t\tconsole.log(`${result.name} has improperly tagged files`);\n\t\t\t}\n\t\t\t// fall through\n\t\t}\n\t} else if (\n\t\t!is_mod &&\n\t\t!is_modpack &&\n\t\tparams.get(\"gameVersion\") &&\n\t\tparams.get(\"gameVersionTypeId\")\n\t) {\n\t\t// handle resourcepacks and worlds\n\t\t// only when version and subversion are both set (otherwise, causes conflicts)\n\t\ttry {\n\t\t\tlet file_id = result.latestFilesIndexes.find(\n\t\t\t\t(file) => file.gameVersionTypeId === version && file.gameVersion === subver\n\t\t\t).fileId;\n\t\t\treturn `${result.links.websiteUrl}/download/${file_id}/file`;\n\t\t} catch (e) {\n\t\t\tif (e instanceof TypeError) {\n\t\t\t\tconsole.log(`${result.name} has improperly tagged files`);\n\t\t\t}\n\t\t\t// fall through\n\t\t}\n\t}\n\treturn `${result.links.websiteUrl}/files/all`;\n}\n\nexport function populate_results_delayed(results_el, filters) {\n\tresults_el.innerHTML = \"\";\n\t// setTimeout to avoid delay in checkbox visual update for large lists\n\tsetTimeout(() => populate_results(results_el, filters, search_results), 0);\n}\n","import { MODLOADERS, SORT_FIELDS, SORT_ORDERS } from \"./consts\";\nimport { sort_subvers } from \"./utils\";\nimport { populate_dropdown, fetch_dropdown_values } from \"./dropdowns\";\nimport {\n\tcurrent_updating_event,\n\tpopulate_results_delayed,\n\tupdate_results as _update_results,\n} from \"./results\";\nimport {\n\tupdate_query_params,\n\tget_active_filters,\n\tpopulate_filters as _populate_filters,\n} from \"./filters\";\n\n(async function () {\n\tconst by_id = document.getElementById.bind(document);\n\n\tconst search_form = by_id(\"search-form\");\n\tconst classes_el = by_id(\"classes\");\n\tconst categories_el = by_id(\"categories\");\n\tconst modloader_el = by_id(\"modloader\");\n\tconst version_el = by_id(\"version\");\n\tconst sub_version_el = by_id(\"sub-version\");\n\tconst sort_field_el = by_id(\"sort-field\");\n\tconst sort_order_el = by_id(\"sort-order\");\n\tconst page_size_el = by_id(\"page-size\");\n\n\tconst reset_button = by_id(\"reset\");\n\n\tconst page_els = document.getElementsByClassName(\"page\");\n\tconst loading_indicator = by_id(\"loading-indicator\");\n\tconst results_el = by_id(\"results\");\n\n\tconst sidebar_el = by_id(\"sidebar\");\n\tconst filters_el = by_id(\"filters\");\n\tconst version_filters_els = document.getElementsByClassName(\"version-filter\");\n\tconst show_filters = by_id(\"show-filters\");\n\tconst show_id = by_id(\"show-id\");\n\tconst show_author = by_id(\"show-author\"); // eslint-disable-line sonarjs/no-duplicate-string\n\n\tconst update_results = (event_name) => {\n\t\t_update_results(\n\t\t\tresults_el,\n\t\t\tloading_indicator,\n\t\t\tnew FormData(search_form),\n\t\t\tget_active_filters(filters_el, version_filters_els),\n\t\t\tpage,\n\t\t\tevent_name\n\t\t);\n\t};\n\tconst populate_filters = _populate_filters.bind(_populate_filters, filters_el);\n\n\tlet page = 0;\n\t// avoid triggering update_results when you trigger change event programmatically\n\t// (in order to populate dropdowns for prefill and default)\n\tlet should_update = false;\n\n\t// fetch values for dropdowns\n\tlet [classes, categories, versions, sub_versions] = await fetch_dropdown_values();\n\n\t// categories\n\tpopulate_dropdown(categories_el, []);\n\n\tclasses_el.addEventListener(\"change\", function () {\n\t\tupdate_modloader();\n\n\t\tlet class_ = classes_el.value;\n\t\tlet categories2 = categories[class_].map((category) => [category.name, category.id]);\n\n\t\tpopulate_dropdown(categories_el, categories2);\n\n\t\tpopulate_filters(categories2, update_result_filters);\n\t});\n\n\t// classes\n\tpopulate_dropdown(\n\t\tclasses_el,\n\t\tclasses.map((x) => [x.name, x.id]),\n\t\t\"Mods\"\n\t);\n\n\t// modloaders\n\tpopulate_dropdown(modloader_el, MODLOADERS, \"Any\");\n\n\tsub_version_el.addEventListener(\"change\", function () {\n\t\tupdate_modloader();\n\t});\n\n\tfunction disable_modloader() {\n\t\tmodloader_el.title = modloader_el.dataset.title;\n\t\tmodloader_el.disabled = true;\n\t}\n\n\tfunction enable_modloader() {\n\t\tmodloader_el.title = \"\";\n\t\tmodloader_el.disabled = false;\n\t}\n\n\tfunction update_modloader() {\n\t\tif (classes_el.value === \"6\" && sub_version_el.value !== \"\") {\n\t\t\t// if mods is selected and a subver is selected,\n\t\t\t// enable the modloader dropdown\n\t\t\tenable_modloader();\n\t\t} else {\n\t\t\tdisable_modloader();\n\t\t}\n\t}\n\t// versions\n\tpopulate_dropdown(\n\t\tversion_el,\n\t\tversions.map((version) => [version.name, version.id])\n\t);\n\n\t// sub versions\n\tpopulate_dropdown(sub_version_el, []);\n\n\tversion_el.addEventListener(\"change\", function () {\n\t\tdisable_modloader();\n\n\t\tlet val = version_el.value;\n\n\t\t// reset subvers dropdown if version was deselected\n\t\tif (val === \"\") {\n\t\t\tpopulate_dropdown(sub_version_el, []);\n\t\t\treturn;\n\t\t}\n\n\t\tlet version = Number.parseInt(val, 10);\n\n\t\tlet subvers = sort_subvers(sub_versions.find((x) => x.type === version).versions);\n\t\tpopulate_dropdown(\n\t\t\tsub_version_el,\n\t\t\tsubvers.map((x) => [x, x])\n\t\t);\n\t});\n\n\t// sort field and order\n\tpopulate_dropdown(sort_field_el, SORT_FIELDS, \"Total Downloads\");\n\tpopulate_dropdown(sort_order_el, SORT_ORDERS, \"desc\");\n\n\t/* prefill forms based on query params*/\n\tfunction prefill_forms() {\n\t\tshould_update = false;\n\t\tlet params = new URLSearchParams(window.location.search);\n\n\t\t// prefill search form\n\t\tfor (let control of search_form.elements) {\n\t\t\tif (params.has(control.name)) {\n\t\t\t\tcontrol.value = params.get(control.name);\n\t\t\t\tcontrol.dispatchEvent(new Event(\"change\"));\n\t\t\t}\n\t\t}\n\n\t\t// prefill page selector\n\t\tif (params.has(\"page\")) {\n\t\t\tfor (let page_el of page_els) {\n\t\t\t\tpage_el.value = params.get(\"page\") + 1;\n\t\t\t}\n\t\t}\n\n\t\t// prefill visual filters\n\t\tif (params.has(\"filtersInclude\")) {\n\t\t\tlet filters = params.get(\"filtersInclude\").split(\" \");\n\t\t\tfor (let control of filters_el.elements) {\n\t\t\t\tif (filters.includes(control.value)) {\n\t\t\t\t\tcontrol.checked = true;\n\t\t\t\t\tcontrol.dataset.value = \"include\";\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tif (params.has(\"filtersExclude\")) {\n\t\t\tlet filters = params.get(\"filtersExclude\").split(\" \");\n\t\t\tfor (let control of filters_el.elements) {\n\t\t\t\tif (filters.includes(control.value)) {\n\t\t\t\t\tcontrol.indeterminate = true;\n\t\t\t\t\tcontrol.checked = true;\n\t\t\t\t\tcontrol.dataset.value = \"exclude\";\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// prefill version filters\n\t\tif (params.has(\"minVer\")) {\n\t\t\tversion_filters_els[0].value = params.get(\"minVer\");\n\t\t}\n\t\tif (params.has(\"maxVer\")) {\n\t\t\tversion_filters_els[1].value = params.get(\"maxVer\");\n\t\t}\n\n\t\tshould_update = true;\n\t}\n\n\tprefill_forms();\n\n\t/* back + forward history buttons */\n\twindow.addEventListener(\"popstate\", function () {\n\t\treset_form();\n\t\tprefill_forms();\n\t\tupdate_results(\"popstate\");\n\t});\n\n\t/* \"show project ids\" checkbox*/\n\tshow_id.checked = localStorage.getItem(\"show_id\") === \"true\";\n\tif (show_id.checked) {\n\t\tresults_el.classList.add(\"show-id\");\n\t}\n\tshow_id.addEventListener(\"change\", function () {\n\t\tlocalStorage.setItem(\"show_id\", show_id.checked);\n\t\tresults_el.classList.toggle(\"show-id\");\n\t});\n\t/* \"show authors\" checkbox*/\n\tshow_author.checked = localStorage.getItem(\"show_author\") === \"true\";\n\tif (show_author.checked) {\n\t\tresults_el.classList.add(\"show-author\");\n\t}\n\tshow_author.addEventListener(\"change\", function () {\n\t\tlocalStorage.setItem(\"show_author\", show_author.checked);\n\t\tresults_el.classList.toggle(\"show-author\");\n\t});\n\n\t/* visual and version filters */\n\tfunction update_result_filters() {\n\t\t// handle filtering\n\t\tlet filters = get_active_filters(filters_el, version_filters_els);\n\t\tupdate_query_params(window.location.search, filters);\n\t\tpopulate_results_delayed(results_el, filters);\n\t}\n\n\t/* version filters */\n\tfor (let control of version_filters_els) {\n\t\tcontrol.addEventListener(\"change\", function () {\n\t\t\tif (!control.reportValidity()) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tupdate_result_filters();\n\t\t});\n\t}\n\n\t/* show/hide visual filters for small screens */\n\tshow_filters.addEventListener(\"click\", function () {\n\t\tif (sidebar_el.classList.toggle(\"show-filters\")) {\n\t\t\tshow_filters.textContent = \"Hide\";\n\t\t} else {\n\t\t\tshow_filters.textContent = \"Show\";\n\t\t}\n\t});\n\n\t/* override step validation for page size in search form*/\n\t// based on https://stackoverflow.com/a/51585161\n\tpage_size_el.addEventListener(\"invalid\", function (event) {\n\t\tlet el = event.target;\n\t\tfor (let state in el.validity) {\n\t\t\tif (state == \"stepMismatch\") {\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tif (el.validity[state]) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\t\tevent.preventDefault();\n\t\treset_page();\n\t\tupdate_results(\"control_change\");\n\t});\n\n\t/* reset page numbering when query changes*/\n\tfunction reset_page() {\n\t\tpage = 0;\n\t\tfor (let el of page_els) {\n\t\t\tel.value = 1;\n\t\t}\n\t}\n\n\t/* reset form*/\n\tfunction reset_form() {\n\t\tfor (let control of search_form.elements) {\n\t\t\tif (control.dataset.default !== undefined) {\n\t\t\t\tcontrol.value = control.dataset.default;\n\t\t\t} else if (control.type === \"text\") {\n\t\t\t\tcontrol.value = \"\";\n\t\t\t}\n\t\t}\n\n\t\tfor (let control of filters_el.elements) {\n\t\t\tcontrol.dataset.value = \"off\";\n\t\t\tcontrol.checked = false;\n\t\t\tcontrol.indeterminate = false;\n\t\t}\n\n\t\tfor (let control of version_filters_els) {\n\t\t\tcontrol.value = \"\";\n\t\t}\n\n\t\tfor (let page_el of page_els) {\n\t\t\tpage_el.value = 1;\n\t\t}\n\n\t\tdisable_modloader();\n\t}\n\n\treset_button.addEventListener(\"click\", function (event) {\n\t\tevent.preventDefault();\n\t\thistory.pushState({}, \"\", window.location.pathname);\n\t\treset_form();\n\t\tupdate_results(\"reset\");\n\t});\n\n\t/* handle results updates */\n\n\t// update results if form is submitted\n\tsearch_form.addEventListener(\"submit\", function (event) {\n\t\tevent.preventDefault();\n\n\t\tif (current_updating_event !== \"control_change\") {\n\t\t\treset_page();\n\t\t\tupdate_results(\"form_submit\");\n\t\t}\n\t});\n\n\t// update results when page changes\n\tfor (let page_el of page_els) {\n\t\tpage_el.addEventListener(\"change\", function (event) {\n\t\t\tif (!page_el.reportValidity()) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tpage = Number.parseInt(event.target.value, 10) - 1;\n\n\t\t\tfor (let page_el2 of page_els) {\n\t\t\t\tpage_el2.value = page + 1;\n\t\t\t}\n\n\t\t\tlet params = new URLSearchParams(window.location.search);\n\t\t\tparams.set(\"page\", page);\n\t\t\thistory.pushState({}, \"\", \"?\" + params);\n\n\t\t\tupdate_results(\"page_change\");\n\t\t});\n\t}\n\n\t// update results when dropdowns are changed\n\tfor (let control of search_form.elements) {\n\t\tif (control.type !== \"submit\") {\n\t\t\tcontrol.addEventListener(\"change\", function (event) {\n\t\t\t\tif (event.target.form.reportValidity() && should_update) {\n\t\t\t\t\treset_page();\n\t\t\t\t\tupdate_results(\"control_change\");\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n\n\t// fetch default results\n\tupdate_results(\"default\");\n\n\t// allow \"change\" events to call update_results\n\tshould_update = true;\n})();\n"],"names":["GAME_ID","MODLOADERS","SORT_FIELDS","map","v","i","SORT_ORDERS","group_by","xs","key","reduce","rv","x","push","natural_compare","a","b","localeCompare","numeric","format_categories","array","class_id","subcategories","top_level","sort","name","id","subcategory","Object","entries","parseInt","forEach","findIndex","splice","async","cf_api","endpoint","params","additional_args","URLSearchParams","undefined","startsWith","slice","fetch","headers","accept","then","resp","json","data","populate_dropdown","dropdown","values","defaultValue","innerHTML","fragment","document","createDocumentFragment","value","option","createElement","textContent","append","defaultOption","selected","dataset","default","prepend","Array","from","options","find","dispatchEvent","Event","fetch_categories","categories","gameId","classes","broken_classes","filter","includes","class_","broken_mod_categories","fetch_vers","filters_el","checked_callback","category","el","className","checkbox","type","addEventListener","event","target","indeterminate","checked","label","createTextNode","get_active_filters","version_filters_els","filters","elements","include","exclude","pass","fail","e","idx","arr","partition","min_ver","max_ver","update_query_params","params2","set","join","window","location","search","toString","history","pushState","search_results","current_ac","current_updating_event","populate_results","results_el","results","length","result","every","split","latestFilesIndexes","some","file","gameVersion","filter_results","li","title","title_link","title_url","URL","links","websiteUrl","hostname","href","authors","author","author_link","url","subtitle","downloads","number","downloadCount","toFixed","updated","Date","dateModified","toLocaleDateString","created","dateCreated","summary","img","src","iconUrl","download","get_download_url","download_button","logo","thumbnailUrl","alt","is_mod","get","is_modpack","subver","version","Number","modloader","has","is_old_forge","file_id","gameVersionTypeId","modLoader","fileId","TypeError","isNaN","by_id","getElementById","bind","search_form","classes_el","categories_el","modloader_el","version_el","sub_version_el","sort_field_el","sort_order_el","page_size_el","reset_button","page_els","getElementsByClassName","loading_indicator","sidebar_el","show_filters","show_id","show_author","update_results","event_name","form_data","page","abort","AbortController","delete","hidden","queries","page_size","offset","real_page_size","Math","min","index","signal","query_results","query","query_result","flat","error","FormData","populate_filters","should_update","versions","sub_versions","cache_time","localStorage","getItem","now","Promise","all","setItem","JSON","stringify","parse","fetch_dropdown_values","disable_modloader","disabled","update_modloader","prefill_forms","control","page_el","update_result_filters","setTimeout","populate_results_delayed","categories2","val","subvers","endsWith","sort_subvers","reset_form","classList","add","toggle","reportValidity","reset_page","state","validity","preventDefault","pathname","page_el2","form"],"sourceRoot":""}