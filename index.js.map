{"version":3,"file":"index.js","mappings":"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","sources":["webpack://cf-search/./src/scripts/consts.js","webpack://cf-search/./src/scripts/utils.js","webpack://cf-search/./src/scripts/api.js","webpack://cf-search/./src/scripts/dropdowns.js","webpack://cf-search/./src/scripts/filters.js","webpack://cf-search/./src/scripts/results.js","webpack://cf-search/./src/scripts/params.js","webpack://cf-search/./src/scripts/index.js"],"sourcesContent":["// I'm assuming this is safe b/c ferium does the same thing ¯\\_(ツ)_/¯\n// https://github.com/gorilla-devs/ferium/blob/f9bf7906fde4938255bd4e9d95a680ac5646c0b4/src/main.rs#L95\nexport const API_KEY = \"$2a$10$3kFa9lBWciEK.lsp7NyCSupZ3XmlAYixZQ9fTczqsz1/.W9QDnLUy\";\nexport const GAME_ID = 432;\n// omitted Cauldron = 2 and LiteLoader = 3, as there are exactly 0 mods tagged as such\n// see https://discord.com/channels/900128427150028811/900188519081848865/994479752410832946 (Curseforge Dev Discord)\nexport const MODLOADERS = [\n\t[\"Any\", 0],\n\t[\"Fabric\", 4],\n\t[\"NeoForge\", 6],\n\t[\"Forge\", 1],\n\t[\"Quilt\", 5],\n];\n// omitted \"Category\", \"Game Version\", \"Early Access\", \"FeaturedReleased\", \"Rating\"\n// which either don't work or are not useful\nexport const SORT_FIELDS = [\n\t[\"Popularity\", 2],\n\t[\"Total Downloads\", 6],\n\t[\"Last Updated\", 3],\n\t[\"Date Created\", 11],\n\t[\"Name\", 4],\n\t[\"Author\", 5],\n\t[\"Featured\", 1],\n];\nexport const SORT_ORDERS = [\"asc\", \"desc\"].map((v) => [v, v]);\n\nexport const DEFAULT_PARAMS = {\n\tclassId: \"6\", // \"Mods\"\n\tmodLoaderType: \"0\", // \"Any\"\n\tsortField: \"6\", // \"Total Downloads\"\n\tsortOrder: \"desc\",\n\tpageSize: \"50\",\n};\n","/* utility functions */\n// https://stackoverflow.com/a/34890276\nexport function group_by(xs, key) {\n\treturn xs.reduce(function (rv, x) {\n\t\t(rv[x[key]] = rv[x[key]] || []).push(x);\n\t\treturn rv;\n\t}, {});\n}\n\n// https://stackoverflow.com/a/50636286\nexport function partition(array, filter) {\n\tlet pass = [],\n\t\tfail = [];\n\tarray.forEach((e, idx, arr) => (filter(e, idx, arr) ? pass : fail).push(e));\n\treturn [pass, fail];\n}\n\n// based on https://stackoverflow.com/a/9229821\nexport function uniq_by(array, key) {\n\tconst seen = new Set();\n\treturn array.filter(function (item) {\n\t\tif (seen.has(item[key])) {\n\t\t\treturn false;\n\t\t} else {\n\t\t\tseen.add(item[key]);\n\t\t\treturn true;\n\t\t}\n\t});\n}\n\n// based on https://stackoverflow.com/a/4499062\nexport function human_readable(number) {\n\tif (number < 1000) {\n\t\treturn number.toString();\n\t} else if (number < 1000 * 1000) {\n\t\treturn (number / 1000).toFixed(1) + \"K\";\n\t} else {\n\t\treturn (number / 1000 / 1000).toFixed(1) + \"M\";\n\t}\n}\n\nexport function natural_compare(a, b) {\n\treturn a.localeCompare(b, \"en\", { numeric: true });\n}\n\nexport function sort_classes(array) {\n\t// move \"Mods\" and \"Modpacks\" to the top\n\tlet modsIndex = array.findIndex((class_) => class_.name === \"Mods\");\n\tlet modClass = array.splice(modsIndex, 1)[0];\n\tlet modpackIndex = array.findIndex((class_) => class_.name === \"Modpacks\");\n\tlet modpackClass = array.splice(modpackIndex, 1)[0];\n\treturn [modClass, modpackClass].concat(array.sort((a, b) => natural_compare(a.name, b.name)));\n}\n\nexport function format_categories(array, class_id) {\n\tlet subcategories = group_by(array, \"parentCategoryId\");\n\tlet top_level = subcategories[class_id];\n\tdelete subcategories[class_id];\n\n\ttop_level.sort((a, b) => natural_compare(a.name, b.name));\n\n\tfor (let [id, subcategory] of Object.entries(subcategories)) {\n\t\tid = parseInt(id, 10);\n\t\tsubcategory.sort((a, b) => natural_compare(a.name, b.name));\n\t\tsubcategory.forEach((x) => {\n\t\t\tx._is_sub_category = true;\n\t\t});\n\n\t\t// insert subcategories below top level category\n\t\tlet i = top_level.findIndex((x) => x.id === id);\n\t\ttop_level.splice(i + 1, 0, ...subcategory);\n\t}\n\treturn top_level;\n}\n\nexport function clean_vers(versions) {\n\treturn versions\n\t\t.filter(\n\t\t\t(version) => version.name.startsWith(\"Minecraft \") && version.name !== \"Minecraft Beta\"\n\t\t)\n\t\t.map((version) => ({ ...version, name: version.name.slice(\"Minecraft \".length) }));\n}\n\nexport function sort_vers(versions) {\n\treturn versions.sort((a, b) => {\n\t\treturn -natural_compare(a.name, b.name);\n\t});\n}\n\nexport function sort_subvers(subvers) {\n\treturn subvers.sort((a, b) => {\n\t\tif (a.endsWith(\"Snapshot\")) {\n\t\t\treturn 1;\n\t\t} else if (b.endsWith(\"Snapshot\")) {\n\t\t\treturn -1;\n\t\t}\n\t\treturn -natural_compare(a, b);\n\t});\n}\n","import { API_KEY } from \"./consts\";\nexport async function cf_api(endpoint, params, additional_args) {\n\tif (typeof params === \"object\" && !(params instanceof URLSearchParams)) {\n\t\tparams = new URLSearchParams(params);\n\t} else if (params == undefined) {\n\t\tparams = \"\";\n\t}\n\n\tif (endpoint.startsWith(\"/\")) {\n\t\tendpoint = endpoint.slice(1);\n\t}\n\n\treturn fetch(\"https://api.curseforge.com/\" + endpoint + \"?\" + params, {\n\t\theaders: { \"x-api-key\": API_KEY, accept: \"application/json\" },\n\t\t...additional_args,\n\t})\n\t\t.then((resp) => resp.json())\n\t\t.then((json) => json.data);\n}\n","import { sort_classes, group_by, format_categories, sort_vers, clean_vers } from \"./utils\";\nimport { GAME_ID } from \"./consts\";\nimport { cf_api } from \"./api\";\n\n/* populate dropdowns */\nexport function populate_dropdown(dropdown, values, default_value) {\n\tdropdown.innerHTML = \"\";\n\tlet fragment = document.createDocumentFragment();\n\n\tfor (let [name, value] of values) {\n\t\tlet option = document.createElement(\"option\");\n\t\toption.value = value;\n\t\toption.textContent = name;\n\t\tfragment.append(option);\n\t}\n\n\tdropdown.append(fragment);\n\n\tif (default_value == undefined) {\n\t\t// if no default value is specified, create a default option with the category name\n\t\t// based on https://stackoverflow.com/a/8442831\n\t\tlet default_option = document.createElement(\"option\");\n\t\tdefault_option.value = \"\";\n\t\tdefault_option.selected = true;\n\t\tdefault_option.textContent = dropdown.dataset.name;\n\t\tdropdown.dataset.default = \"\";\n\t\tdropdown.prepend(default_option);\n\t} else {\n\t\t// otherwise, select the corresponding <option>\n\t\tlet option = Array.from(dropdown.options).find((x) => x.value === default_value);\n\t\toption.selected = true;\n\t\tdropdown.dataset.default = default_value;\n\t\tdropdown.dispatchEvent(new Event(\"change\"));\n\t}\n}\n\n/* fetch dropdown values from CF API */\nasync function fetch_categories() {\n\tlet categories = await cf_api(\"/v1/categories\", { gameId: GAME_ID });\n\tcategories = group_by(categories, \"classId\");\n\n\tlet classes = sort_classes(categories[undefined]);\n\tdelete categories[undefined];\n\n\t// format categories\n\tfor (let class_ in categories) {\n\t\tcategories[class_] = format_categories(categories[class_], class_);\n\t}\n\n\t// ignore Fabric, FancyMenu, QoL, Vanilla+ tags\n\t// these tags don't exist anymore, idk why they're still in the API\n\tlet broken_mod_categories = [5192, 4780, 5190, 5129];\n\tcategories[6] = categories[6].filter((x) => !broken_mod_categories.includes(x.id));\n\treturn [classes, categories];\n}\n\nasync function fetch_vers() {\n\treturn sort_vers(clean_vers(await cf_api(`/v1/games/${GAME_ID}/version-types`)));\n}\n\nfunction fetch_subvers() {\n\treturn cf_api(`/v1/games/${GAME_ID}/versions`);\n}\n\n// fetch in parallel and cache\nexport async function fetch_dropdown_values() {\n\tlet cache_time = localStorage.getItem(\"cache_time\");\n\tlet now = Date.now();\n\tlet classes, categories, versions, sub_versions;\n\tif (!cache_time || now - cache_time > 24 * 60 * 60 * 1000) {\n\t\tlet result = await Promise.all([fetch_categories(), fetch_vers(), fetch_subvers()]);\n\t\t[[classes, categories], versions, sub_versions] = result;\n\t\tlocalStorage.setItem(\"cache\", JSON.stringify(result));\n\t\tlocalStorage.setItem(\"cache_time\", now);\n\t} else {\n\t\t[[classes, categories], versions, sub_versions] = JSON.parse(localStorage.getItem(\"cache\"));\n\t}\n\treturn [classes, categories, versions, sub_versions];\n}\n","/* handle visual filters */\nimport { natural_compare, partition } from \"./utils\";\nexport function populate_filters(filters_el, categories, checked_callback) {\n\tfilters_el.innerHTML = \"\";\n\tlet fragment = document.createDocumentFragment();\n\n\tfor (let category of categories) {\n\t\tlet el = document.createElement(\"label\");\n\t\tel.className = \"checkbox-label\";\n\t\tif (category._is_sub_category) {\n\t\t\tel.classList.add(\"checkbox-label-nested\");\n\t\t}\n\n\t\tlet checkbox = document.createElement(\"input\");\n\t\tcheckbox.type = \"checkbox\";\n\t\tcheckbox.name = category.name;\n\t\tcheckbox.value = category.id;\n\n\t\tcheckbox.addEventListener(\"change\", function (event) {\n\t\t\t// custom checkbox behavior for filters\n\t\t\t// cycle from off, include, exclude\n\t\t\tlet el = event.target;\n\t\t\tif (!el.dataset.value || el.dataset.value === \"off\") {\n\t\t\t\t// off -> include\n\t\t\t\tel.checked = true;\n\t\t\t\tel.indeterminate = false;\n\t\t\t\tel.dataset.value = \"include\";\n\t\t\t} else if (el.dataset.value === \"include\") {\n\t\t\t\t// include -> exclude\n\t\t\t\tel.indeterminate = true;\n\t\t\t\tel.checked = true;\n\t\t\t\tel.dataset.value = \"exclude\";\n\t\t\t} else {\n\t\t\t\t// exclude -> off\n\t\t\t\tel.checked = false;\n\t\t\t\tel.indeterminate = false;\n\t\t\t\tel.dataset.value = \"off\";\n\t\t\t}\n\n\t\t\t// handle filtering\n\t\t\tchecked_callback();\n\t\t});\n\n\t\tlet label = document.createTextNode(category.name);\n\t\tel.append(checkbox, label);\n\t\tfragment.append(el);\n\t}\n\n\tfilters_el.append(fragment);\n}\n\nexport function get_active_filters(filters_el, version_filters_els) {\n\tlet filters = Array.from(filters_el.elements).filter((x) => x.checked);\n\tlet [include, exclude] = partition(filters, (x) => x.dataset.value === \"include\");\n\t[include, exclude] = [\n\t\tinclude.map((x) => parseInt(x.value, 10)),\n\t\texclude.map((x) => parseInt(x.value, 10)),\n\t];\n\n\tlet [min_ver, max_ver] = Array.from(version_filters_els).map((x) => x.value);\n\n\treturn { include, exclude, max_ver, min_ver };\n}\n\nexport function filter_results(results, filters, hidden_authors) {\n\tlet { include, exclude, max_ver, min_ver } = filters;\n\t// handle includes\n\tif (include.length > 0) {\n\t\tresults = results.filter((result) =>\n\t\t\tinclude.every((id) => result.categories.find((category) => category.id === id))\n\t\t);\n\t}\n\n\t// handle excludes\n\tif (exclude.length > 0) {\n\t\tresults = results.filter((result) =>\n\t\t\tresult.categories.every((category) => !exclude.includes(category.id))\n\t\t);\n\t}\n\n\t// handle max ver\n\tif (max_ver.length > 0) {\n\t\tif (max_ver.split(\".\").length === 2) {\n\t\t\t// only major version provided (eg. \"1.12\"),\n\t\t\t// so we add a string that will always compare greater than all of the subvers for that major ver\n\t\t\tmax_ver += \"a\";\n\t\t}\n\t\tresults = results.filter((result) =>\n\t\t\tresult.latestFilesIndexes.some(\n\t\t\t\t(file) => natural_compare(file.gameVersion, max_ver) <= 0\n\t\t\t)\n\t\t);\n\t}\n\n\t// handle min ver\n\tif (min_ver.length > 0) {\n\t\tresults = results.filter((result) =>\n\t\t\tresult.latestFilesIndexes.some(\n\t\t\t\t(file) => natural_compare(file.gameVersion, min_ver) >= 0\n\t\t\t)\n\t\t);\n\t}\n\n\t// handle authors\n\tif (hidden_authors.length > 0) {\n\t\tresults = results.filter(\n\t\t\t(result) =>\n\t\t\t\t!result.authors.some((author) => hidden_authors.includes(author.name.toLowerCase()))\n\t\t);\n\t}\n\n\treturn results;\n}\n","import { filter_results } from \"./filters\";\nimport { GAME_ID } from \"./consts\";\nimport { cf_api } from \"./api\";\nimport { human_readable, natural_compare, uniq_by } from \"./utils\";\n\nlet search_results = [];\n\n// prevent double update_results with an AbortController\nlet current_ac = null;\nexport let current_updating_event = \"\";\n\nfunction fix_hostname(original_url, is_legacy_cf) {\n\t// replace hostname to fix #8\n\tlet url = new URL(original_url);\n\turl.hostname = is_legacy_cf ? \"legacy.curseforge.com\" : \"www.curseforge.com\";\n\treturn url.toString();\n}\nexport async function* fetch_results(form_data, page, event_name) {\n\tlet params = new URLSearchParams(form_data);\n\n\t// index + page_size <= 10,000 is a CF API limitation\n\tlet page_size = Number.parseInt(params.get(\"pageSize\"), 10);\n\tif (page_size * (page + 1) > 10000) {\n\t\talert(\"The desired page is too large for the Curseforge API\");\n\t\treturn;\n\t}\n\n\t// cancel any updates in progress\n\tif (current_ac !== null) {\n\t\tcurrent_ac.abort();\n\t}\n\n\tcurrent_ac = new AbortController();\n\tcurrent_updating_event = event_name;\n\n\tparams.append(\"gameId\", GAME_ID);\n\n\t// workaround for Curseforge API being bad\n\tif (params.get(\"modLoaderType\") === \"0\") {\n\t\tparams.delete(\"modLoaderType\");\n\t}\n\n\tsearch_results = [];\n\ttry {\n\t\t// since CF API only lets us fetch 50 items at a time,\n\t\t// we have to split the desired pageSize into multiple requests\n\t\tlet queries = [];\n\t\tfor (let offset = 0; offset < page_size; offset += 50) {\n\t\t\tlet real_page_size = Math.min(50, page_size - offset);\n\t\t\tlet params2 = new URLSearchParams(params);\n\n\t\t\t// index is the index of the first item to include in the response\n\t\t\tlet index = page_size * page + offset;\n\n\t\t\tparams2.set(\"index\", index);\n\t\t\tparams2.set(\"pageSize\", real_page_size);\n\n\t\t\t// workaround for #10\n\t\t\t// we do it here so it doesn't affect the modpack branch of get_download_url\n\t\t\tif (params2.get(\"gameVersion\")) {\n\t\t\t\tparams2.delete(\"gameVersionTypeId\");\n\t\t\t}\n\n\t\t\tqueries.push(cf_api(\"/v1/mods/search\", params2, { signal: current_ac.signal }));\n\t\t}\n\n\t\t// await each query sequentially to ensure result elements are properly ordered\n\t\tlet query_results = [];\n\t\tfor (let query of queries) {\n\t\t\tlet query_result = (await query).filter(\n\t\t\t\t// fix CF API returning shaders in customization search\n\t\t\t\t(result) => result.classId === parseInt(params.get(\"classId\"), 10)\n\t\t\t);\n\t\t\tconsole.log(query_result);\n\t\t\tyield query_result;\n\t\t\tquery_results.push(query_result);\n\t\t}\n\t\tsearch_results = query_results.flat();\n\n\t\tcurrent_ac = null;\n\t\tcurrent_updating_event = null;\n\t} catch (error) {\n\t\tif (error.name !== \"AbortError\") {\n\t\t\tthrow error;\n\t\t}\n\t}\n}\n\nexport function populate_results(results_el, filters, results, settings) {\n\tresults = filter_results(results, filters, settings.hidden_authors.value);\n\n\tlet params = new URLSearchParams(window.location.search);\n\n\tlet fragment = document.createDocumentFragment();\n\tfor (let result of results) {\n\t\tlet li = document.createElement(\"li\");\n\t\tli.className = \"result\";\n\n\t\t//title\n\t\tlet title = document.createElement(\"div\");\n\t\ttitle.className = \"result-title\";\n\n\t\tlet title_link = document.createElement(\"a\");\n\t\ttitle_link.className = \"result-title-link\";\n\t\ttitle_link.href = fix_hostname(result.links.websiteUrl, settings.use_legacy_cf.value);\n\t\ttitle_link.textContent = result.name;\n\t\ttitle.append(title_link);\n\n\t\t// check needed to fix #9\n\t\tif (result.authors.length > 0) {\n\t\t\tlet author = document.createElement(\"span\");\n\t\t\tauthor.className = \"result-author\";\n\t\t\tlet author_link = document.createElement(\"a\");\n\t\t\tauthor_link.className = \"result-author-link\";\n\t\t\tauthor_link.href = fix_hostname(result.authors[0].url, settings.use_legacy_cf.value);\n\t\t\tauthor_link.textContent = result.authors[0].name;\n\t\t\tauthor.append(\"by\", author_link);\n\t\t\ttitle.append(author);\n\t\t}\n\n\t\t// subtitle\n\t\tlet subtitle = document.createElement(\"div\");\n\t\tsubtitle.className = \"result-subtitle\";\n\t\tlet downloads = document.createElement(\"span\");\n\t\tdownloads.textContent = `${human_readable(result.downloadCount)} Downloads`;\n\t\tlet updated = document.createElement(\"span\");\n\t\tupdated.textContent = `Updated ${new Date(result.dateModified).toLocaleDateString()}`;\n\t\tlet created = document.createElement(\"span\");\n\t\tcreated.textContent = `Created ${new Date(result.dateCreated).toLocaleDateString()}`;\n\t\tsubtitle.append(downloads, updated, created);\n\n\t\t// summary\n\t\tlet summary = document.createElement(\"p\");\n\t\tsummary.className = \"result-summary\";\n\t\tsummary.textContent = result.summary;\n\n\t\t// category images\n\t\tlet categories = document.createElement(\"div\");\n\t\tcategories.className = \"result-categories\";\n\t\t// uniquify categories to fix #20\n\t\tfor (let category of uniq_by(result.categories, \"id\")) {\n\t\t\t// TODO change link to change form param instead\n\t\t\tlet category_el = document.createElement(\"a\");\n\t\t\tcategory_el.href = fix_hostname(category.url, settings.use_legacy_cf.value);\n\n\t\t\tlet category_img = document.createElement(\"img\");\n\t\t\tcategory_img.className = \"result-category-image\";\n\t\t\tcategory_img.src = category.iconUrl;\n\t\t\tcategory_img.title = category.name;\n\n\t\t\tcategory_el.append(category_img);\n\t\t\tcategories.append(category_el);\n\t\t}\n\n\t\t// project id\n\t\tlet id = document.createElement(\"span\");\n\t\tid.className = \"result-project-id\";\n\t\tid.textContent = `Project ID: ${result.id}`;\n\n\t\t// download button\n\t\tlet download = document.createElement(\"a\");\n\t\tdownload.className = \"download-button\";\n\t\tdownload.href = fix_hostname(\n\t\t\tget_download_url(result, params),\n\t\t\tsettings.use_legacy_cf.value\n\t\t);\n\t\tlet download_button = document.createElement(\"button\");\n\t\tdownload_button.textContent = \"Download\";\n\t\t// nesting an <button> within an <a> is technically invalid HTML5, but I don't care\n\t\tdownload.append(download_button);\n\n\t\t//logo\n\t\tlet logo = document.createElement(\"img\");\n\t\tlogo.className = \"result-logo\";\n\t\tif (result.logo) {\n\t\t\t// fallback to url (fixes #18)\n\t\t\tlogo.src = result.logo.thumbnailUrl || result.logo.url;\n\t\t}\n\t\tlogo.alt = \"\";\n\n\t\tli.append(logo, categories, download, id, title, subtitle, summary);\n\t\tfragment.append(li);\n\t}\n\tresults_el.append(fragment);\n}\n\nfunction get_download_url(result, params) {\n\tlet is_mod = params.get(\"classId\") === \"6\";\n\tlet is_modpack = params.get(\"classId\") === \"4471\";\n\tlet subver = params.get(\"gameVersion\");\n\tlet version = Number.parseInt(params.get(\"gameVersionTypeId\"), 10);\n\tlet modloader = Number.parseInt(params.get(\"modLoaderType\"), 10);\n\n\t// handle mods where subver and mod loader are both set\n\t// otherwise file to download is ambigious (file for the wrong MC version will break)\n\tif (\n\t\tis_mod &&\n\t\tparams.get(\"gameVersion\") &&\n\t\tparams.has(\"modLoaderType\") &&\n\t\tparams.get(\"modLoaderType\") !== \"0\"\n\t) {\n\t\t// fabric didn't exist before 1.14, so a lot of the old files are untagged with mod loader\n\t\tlet is_old_forge = natural_compare(subver, \"1.14\") < 0 && modloader === 1;\n\n\t\ttry {\n\t\t\tlet file_id = result.latestFilesIndexes.find(\n\t\t\t\t(file) =>\n\t\t\t\t\tfile.gameVersion === subver &&\n\t\t\t\t\t(file.modLoader === modloader || (file.modLoader == null && is_old_forge))\n\t\t\t).fileId;\n\t\t\treturn `${result.links.websiteUrl}/download/${file_id}/file`;\n\t\t} catch (e) {\n\t\t\tif (e instanceof TypeError) {\n\t\t\t\tconsole.log(`${result.name} has improperly tagged files`);\n\t\t\t}\n\t\t\t// fall through\n\t\t}\n\t} else if (is_modpack) {\n\t\t// handle all modpacks\n\t\t// if subver is unset, fallback to latest from the version\n\t\t// if ver is unset, fallback to latest file from any MC version.\n\t\t// This is safe, because downloading a pack for a random MC version *won't* cause conflicts,\n\t\t// unlike mods, resourcepacks, or worlds where a file for the wrong MC version will break something.\n\t\ttry {\n\t\t\tlet file_id = result.latestFilesIndexes.find(\n\t\t\t\t(file) =>\n\t\t\t\t\t(Number.isNaN(version) || file.gameVersionTypeId === version) &&\n\t\t\t\t\t(!subver || file.gameVersion === subver)\n\t\t\t).fileId;\n\t\t\treturn `${result.links.websiteUrl}/download/${file_id}/file`;\n\t\t} catch (e) {\n\t\t\tif (e instanceof TypeError) {\n\t\t\t\tconsole.log(`${result.name} has improperly tagged files`);\n\t\t\t}\n\t\t\t// fall through\n\t\t}\n\t} else if (!is_mod && !is_modpack && params.get(\"gameVersion\")) {\n\t\t// handle resourcepacks and worlds\n\t\t// only when subversion is set (otherwise, causes conflicts)\n\t\ttry {\n\t\t\tlet file_id = result.latestFilesIndexes.find(\n\t\t\t\t(file) => file.gameVersion === subver\n\t\t\t).fileId;\n\t\t\treturn `${result.links.websiteUrl}/download/${file_id}/file`;\n\t\t} catch (e) {\n\t\t\tif (e instanceof TypeError) {\n\t\t\t\tconsole.log(`${result.name} has improperly tagged files`);\n\t\t\t}\n\t\t\t// fall through\n\t\t}\n\t}\n\treturn `${result.links.websiteUrl}/files/all`;\n}\n\nexport function refresh_results(results_el, filters, settings) {\n\t// refresh results based on updated filters/settings\n\t// setTimeout to avoid delay in checkbox visual update for large lists\n\tsetTimeout(() => {\n\t\tresults_el.innerHTML = \"\";\n\t\tpopulate_results(results_el, filters, search_results, settings);\n\t}, 0);\n}\n","import { DEFAULT_PARAMS } from \"./consts\";\n\nconst API_PARAM_MAP = new Map([\n\t[\"class\", \"classId\"],\n\t[\"category\", \"categoryId\"],\n\t[\"version\", \"gameVersionTypeId\"],\n\t[\"sub_version\", \"gameVersion\"],\n\t[\"modloader\", \"modLoaderType\"],\n\t[\"sort_field\", \"sortField\"],\n\t[\"sort_order\", \"sortOrder\"],\n\t[\"search\", \"searchFilter\"],\n\t[\"page_size\", \"pageSize\"],\n]);\n\n// map from old query string names to new ones\nconst LEGACY_PARAM_MAP = new Map([\n\t...API_PARAM_MAP.entries().map(([k, v]) => [v, k]),\n\t[\"filtersInclude\", \"include_filters\"],\n\t[\"filtersExclude\", \"exclude_filters\"],\n\t[\"maxVer\", \"max_ver\"],\n\t[\"minVer\", \"min_ver\"],\n]);\n\nexport function update_query_params(params, filters) {\n\tlet params2 = new URLSearchParams(params);\n\t// don't overwrite filters query params\n\tlet { include, exclude, max_ver, min_ver } = filters;\n\tparams2.set(\"filtersInclude\", include.join(\" \"));\n\tparams2.set(\"filtersExclude\", exclude.join(\" \"));\n\tparams2.set(\"maxVer\", max_ver);\n\tparams2.set(\"minVer\", min_ver);\n\n\t// remove unnecessary query params\n\t// use Array.from to clone the entries to avoid deleting values from what we're iterating over\n\tfor (let [key, value] of Array.from(params2.entries())) {\n\t\tif ((key in DEFAULT_PARAMS && value === DEFAULT_PARAMS[key]) || value === \"\") {\n\t\t\tparams2.delete(key);\n\t\t}\n\t}\n\tif (window.location.search !== \"?\" + params2.toString()) {\n\t\thistory.pushState({}, \"\", \"?\" + params2.toString());\n\t}\n}\n\nexport function to_api_params(params) {\n\tlet new_params = new URLSearchParams();\n\tfor (let [key, value] of params.entries()) {\n\t\tnew_params.append(API_PARAM_MAP.get(key) || key, value);\n\t}\n\treturn new_params;\n}\n\nexport function load_query_params() {\n\tlet params = new URLSearchParams(window.location.search);\n\tlet new_params = new Map();\n\tfor (let [key, value] of params) {\n\t\tnew_params.set(LEGACY_PARAM_MAP.get(key) || key, value);\n\t}\n\n\treturn new_params;\n}\n","import { MODLOADERS, SORT_FIELDS, SORT_ORDERS, DEFAULT_PARAMS } from \"./consts\";\nimport { sort_subvers } from \"./utils\";\nimport { populate_dropdown, fetch_dropdown_values } from \"./dropdowns\";\nimport {\n\tcurrent_updating_event,\n\trefresh_results,\n\tfetch_results,\n\tpopulate_results,\n} from \"./results\";\nimport { get_active_filters, populate_filters as _populate_filters } from \"./filters\";\n\nimport { update_query_params, load_query_params, to_api_params } from \"./params\";\n// eslint-disable-next-line sonarjs/cognitive-complexity\n(async function () {\n\tconst by_id = document.getElementById.bind(document);\n\n\tconst search_form = by_id(\"search-form\");\n\tconst classes_el = by_id(\"classes\");\n\tconst categories_el = by_id(\"categories\");\n\tconst modloader_el = by_id(\"modloader\");\n\tconst version_el = by_id(\"version\");\n\tconst sub_version_el = by_id(\"sub-version\");\n\tconst sort_field_el = by_id(\"sort-field\");\n\tconst sort_order_el = by_id(\"sort-order\");\n\tconst page_size_el = by_id(\"page-size\");\n\n\tconst reset_button = by_id(\"reset\");\n\n\tconst page_els = document.getElementsByClassName(\"page\");\n\tconst loading_indicator = by_id(\"loading-indicator\");\n\tconst results_el = by_id(\"results\");\n\n\tconst sidebar_el = by_id(\"sidebar\");\n\tconst filters_el = by_id(\"filters\");\n\tconst version_filters_els = document.getElementsByClassName(\"version-filter\");\n\tconst show_filters = by_id(\"show-filters\");\n\n\tconst settings = {\n\t\tshow_id: {\n\t\t\tvalue: false,\n\t\t\ton_change(toggled) {\n\t\t\t\tresults_el.classList.toggle(\"show-id\", toggled);\n\t\t\t},\n\t\t},\n\t\tshow_author: {\n\t\t\tvalue: false,\n\t\t\ton_change(toggled) {\n\t\t\t\tresults_el.classList.toggle(\"show-author\", toggled);\n\t\t\t},\n\t\t},\n\t\tuse_legacy_cf: {\n\t\t\tvalue: false,\n\t\t\ton_change() {\n\t\t\t\tlet filters = get_active_filters(filters_el, version_filters_els);\n\t\t\t\trefresh_results(results_el, filters, settings);\n\t\t\t},\n\t\t},\n\t\thidden_authors: {\n\t\t\t_value: [],\n\t\t\tset value(value) {\n\t\t\t\tthis._value = value.split(\",\").map((author) => author.trim().toLowerCase());\n\t\t\t},\n\t\t\tget value() {\n\t\t\t\treturn this._value;\n\t\t\t},\n\t\t\ton_change() {\n\t\t\t\tlet filters = get_active_filters(filters_el, version_filters_els);\n\t\t\t\trefresh_results(results_el, filters, settings);\n\t\t\t},\n\t\t},\n\t};\n\n\tlet page = 0;\n\t// avoid triggering update_results when you trigger change event programmatically\n\t// (in order to populate dropdowns for prefill and default)\n\tlet should_update = false;\n\n\tasync function update_results(event_name) {\n\t\tlet params = new FormData(search_form);\n\t\tlet filters = get_active_filters(filters_el, version_filters_els);\n\n\t\t// update query params only if search parameters were modified\n\t\tif (event_name === \"control_change\") {\n\t\t\tupdate_query_params(params, filters);\n\t\t}\n\n\t\tloading_indicator.hidden = false;\n\t\tresults_el.innerHTML = \"\";\n\n\t\tfor await (let query_result of fetch_results(to_api_params(params), page, event_name)) {\n\t\t\tpopulate_results(results_el, filters, query_result, settings);\n\t\t}\n\n\t\tloading_indicator.hidden = true;\n\t}\n\tconst populate_filters = _populate_filters.bind(_populate_filters, filters_el);\n\n\t// fetch values for dropdowns\n\tlet [classes, categories, versions, sub_versions] = await fetch_dropdown_values();\n\n\t// categories\n\tpopulate_dropdown(categories_el, []);\n\n\tclasses_el.addEventListener(\"change\", function () {\n\t\tupdate_modloader();\n\n\t\tlet class_ = classes_el.value;\n\t\tlet category_dropdown_values = categories[class_].map((category) => [\n\t\t\tcategory._is_sub_category ? \" └ \" + category.name : category.name,\n\t\t\tcategory.id,\n\t\t]);\n\n\t\tpopulate_dropdown(categories_el, category_dropdown_values);\n\n\t\tpopulate_filters(categories[class_], update_result_filters);\n\t});\n\n\t// classes\n\tpopulate_dropdown(\n\t\tclasses_el,\n\t\tclasses.map((x) => [x.name, x.id]),\n\t\tDEFAULT_PARAMS.classId\n\t);\n\n\t// modloaders\n\tpopulate_dropdown(modloader_el, MODLOADERS, DEFAULT_PARAMS.modLoaderType);\n\n\tfunction disable_modloader() {\n\t\tmodloader_el.title = modloader_el.dataset.title;\n\t\tmodloader_el.disabled = true;\n\t}\n\n\tfunction enable_modloader() {\n\t\tmodloader_el.title = \"\";\n\t\tmodloader_el.disabled = false;\n\t}\n\n\tfunction update_modloader() {\n\t\tif (\n\t\t\t[\"Mods\", \"Modpacks\", \"Worlds\"].includes(\n\t\t\t\tclasses.find((class_) => class_.id === parseInt(classes_el.value, 10)).name\n\t\t\t)\n\t\t) {\n\t\t\t// if mods or modpacks are selected\n\t\t\t// enable the modloader dropdown\n\t\t\tenable_modloader();\n\t\t} else {\n\t\t\tdisable_modloader();\n\t\t}\n\t}\n\t// versions\n\tpopulate_dropdown(\n\t\tversion_el,\n\t\tversions.map((version) => [version.name, version.id])\n\t);\n\n\t// sub versions\n\tpopulate_dropdown(sub_version_el, []);\n\n\tversion_el.addEventListener(\"change\", function () {\n\t\tlet val = version_el.value;\n\n\t\t// reset subvers dropdown if version was deselected\n\t\tif (val === \"\") {\n\t\t\tpopulate_dropdown(sub_version_el, []);\n\t\t\treturn;\n\t\t}\n\n\t\tlet version = Number.parseInt(val, 10);\n\n\t\tlet subvers = sort_subvers(sub_versions.find((x) => x.type === version).versions);\n\t\tpopulate_dropdown(\n\t\t\tsub_version_el,\n\t\t\tsubvers.map((x) => [x, x])\n\t\t);\n\t});\n\n\t// sort field and order\n\tpopulate_dropdown(sort_field_el, SORT_FIELDS, DEFAULT_PARAMS.sortField);\n\tpopulate_dropdown(sort_order_el, SORT_ORDERS, DEFAULT_PARAMS.sortOrder);\n\n\t/* prefill forms based on query params*/\n\tfunction prefill_forms() {\n\t\tshould_update = false;\n\t\tconst params = load_query_params();\n\n\t\t// prefill search form\n\t\tfor (let control of search_form.elements) {\n\t\t\tif (params.has(control.name)) {\n\t\t\t\tcontrol.value = params.get(control.name);\n\t\t\t\tcontrol.dispatchEvent(new Event(\"change\"));\n\t\t\t}\n\t\t}\n\n\t\t// prefill page selector\n\t\tif (params.has(\"page\")) {\n\t\t\tfor (let page_el of page_els) {\n\t\t\t\tpage_el.value = params.get(\"page\");\n\t\t\t}\n\t\t}\n\n\t\t// prefill visual filters\n\t\tif (params.has(\"include_filters\")) {\n\t\t\tlet filters = params.get(\"include_filters\").split(\" \");\n\t\t\tfor (let control of filters_el.elements) {\n\t\t\t\tif (filters.includes(control.value)) {\n\t\t\t\t\tcontrol.checked = true;\n\t\t\t\t\tcontrol.dataset.value = \"include\";\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tif (params.has(\"exclude_filters\")) {\n\t\t\tlet filters = params.get(\"exclude_filters\").split(\" \");\n\t\t\tfor (let control of filters_el.elements) {\n\t\t\t\tif (filters.includes(control.value)) {\n\t\t\t\t\tcontrol.indeterminate = true;\n\t\t\t\t\tcontrol.checked = true;\n\t\t\t\t\tcontrol.dataset.value = \"exclude\";\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// prefill version filters\n\t\tif (params.has(\"min_version\")) {\n\t\t\tversion_filters_els[0].value = params.get(\"min_version\");\n\t\t}\n\t\tif (params.has(\"max_version\")) {\n\t\t\tversion_filters_els[1].value = params.get(\"max_version\");\n\t\t}\n\n\t\tshould_update = true;\n\t}\n\n\tprefill_forms();\n\n\t/* back + forward history buttons */\n\twindow.addEventListener(\"popstate\", function () {\n\t\treset_form();\n\t\tprefill_forms();\n\t\tupdate_results(\"popstate\");\n\t});\n\n\t/* setttings checkboxes*/\n\tfor (let setting in settings) {\n\t\tlet input = by_id(setting.replace(/_/g, \"-\"));\n\n\t\tif (input.type === \"checkbox\") {\n\t\t\tinput.checked = localStorage.getItem(setting) === \"true\";\n\t\t} else {\n\t\t\tinput.value = localStorage.getItem(setting);\n\t\t}\n\n\t\tlet on_change = function () {\n\t\t\tlet value = input.type === \"checkbox\" ? input.checked : input.value;\n\t\t\t// on_change should recieve a value modified by getters/setters, but localStorage shouldn't\n\t\t\tlocalStorage.setItem(setting, value);\n\t\t\tsettings[setting].value = value;\n\t\t\tsettings[setting].on_change(settings[setting].value);\n\t\t};\n\n\t\tinput.addEventListener(\"change\", on_change);\n\t\ton_change();\n\t}\n\n\t/* visual and version filters */\n\tfunction update_result_filters() {\n\t\t// handle filtering\n\t\tlet filters = get_active_filters(filters_el, version_filters_els);\n\t\tupdate_query_params(window.location.search, filters);\n\n\t\trefresh_results(results_el, filters, settings);\n\t}\n\n\t/* version filters */\n\tfor (let control of version_filters_els) {\n\t\tcontrol.addEventListener(\"change\", function () {\n\t\t\tif (!control.reportValidity()) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tupdate_result_filters();\n\t\t});\n\t}\n\n\t/* show/hide visual filters for small screens */\n\tshow_filters.addEventListener(\"click\", function () {\n\t\tif (sidebar_el.classList.toggle(\"show-filters\")) {\n\t\t\tshow_filters.textContent = \"Hide\";\n\t\t} else {\n\t\t\tshow_filters.textContent = \"Show\";\n\t\t}\n\t});\n\n\t/* override step validation for page size in search form*/\n\t// based on https://stackoverflow.com/a/51585161\n\tpage_size_el.addEventListener(\"invalid\", function (event) {\n\t\tlet el = event.target;\n\t\tfor (let state in el.validity) {\n\t\t\tif (state === \"stepMismatch\") {\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tif (el.validity[state]) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\t\tevent.preventDefault();\n\t\treset_page();\n\t\tupdate_results(\"control_change\");\n\t});\n\n\t/* reset page numbering when query changes*/\n\tfunction reset_page() {\n\t\tpage = 0;\n\t\tfor (let el of page_els) {\n\t\t\tel.value = 1;\n\t\t}\n\t}\n\n\t/* reset form*/\n\tfunction reset_form() {\n\t\tfor (let control of search_form.elements) {\n\t\t\tif (control.dataset.default !== undefined) {\n\t\t\t\tcontrol.value = control.dataset.default;\n\t\t\t} else if (control.type === \"text\") {\n\t\t\t\tcontrol.value = \"\";\n\t\t\t}\n\t\t}\n\n\t\tfor (let control of filters_el.elements) {\n\t\t\tcontrol.dataset.value = \"off\";\n\t\t\tcontrol.checked = false;\n\t\t\tcontrol.indeterminate = false;\n\t\t}\n\n\t\tfor (let control of version_filters_els) {\n\t\t\tcontrol.value = \"\";\n\t\t}\n\n\t\tfor (let page_el of page_els) {\n\t\t\tpage_el.value = 1;\n\t\t}\n\t}\n\n\treset_button.addEventListener(\"click\", function (event) {\n\t\tevent.preventDefault();\n\t\thistory.pushState({}, \"\", window.location.pathname);\n\t\treset_form();\n\t\tupdate_results(\"reset\");\n\t});\n\n\t/* handle results updates */\n\n\t// update results if form is submitted\n\tsearch_form.addEventListener(\"submit\", function (event) {\n\t\tevent.preventDefault();\n\n\t\tif (current_updating_event !== \"control_change\") {\n\t\t\treset_page();\n\t\t\tupdate_results(\"form_submit\");\n\t\t}\n\t});\n\n\t// update results when page changes\n\tfor (let page_el of page_els) {\n\t\tpage_el.addEventListener(\"change\", function (event) {\n\t\t\tif (!page_el.reportValidity()) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tpage = Number.parseInt(event.target.value, 10) - 1;\n\n\t\t\tfor (let page_el2 of page_els) {\n\t\t\t\tpage_el2.value = page + 1;\n\t\t\t}\n\n\t\t\tlet params = new URLSearchParams(window.location.search);\n\t\t\tparams.set(\"page\", page + 1);\n\t\t\thistory.pushState({}, \"\", \"?\" + params);\n\n\t\t\tupdate_results(\"page_change\");\n\t\t});\n\t}\n\n\t// update results when dropdowns are changed\n\tfor (let control of search_form.elements) {\n\t\tif (control.type !== \"submit\") {\n\t\t\tcontrol.addEventListener(\"change\", function (event) {\n\t\t\t\tif (event.target.form.reportValidity() && should_update) {\n\t\t\t\t\treset_page();\n\t\t\t\t\tupdate_results(\"control_change\");\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n\n\t// fetch default results\n\tupdate_results(\"default\");\n\n\t// allow \"change\" events to call update_results\n\tshould_update = true;\n})();\n"],"names":["API_KEY","GAME_ID","MODLOADERS","SORT_FIELDS","SORT_ORDERS","map","v","DEFAULT_PARAMS","classId","modLoaderType","sortField","sortOrder","pageSize","group_by","xs","key","reduce","rv","x","push","uniq_by","array","seen","Set","filter","item","has","add","natural_compare","a","b","localeCompare","numeric","format_categories","class_id","subcategories","top_level","sort","name","id","subcategory","Object","entries","parseInt","forEach","_is_sub_category","i","findIndex","splice","async","cf_api","endpoint","params","additional_args","URLSearchParams","undefined","startsWith","slice","fetch","headers","accept","then","resp","json","data","populate_dropdown","dropdown","values","default_value","innerHTML","fragment","document","createDocumentFragment","value","option","createElement","textContent","append","default_option","selected","dataset","default","prepend","Array","from","options","find","dispatchEvent","Event","fetch_categories","categories","gameId","classes","modsIndex","class_","modClass","modpackIndex","concat","sort_classes","broken_mod_categories","includes","fetch_vers","versions","sort_vers","version","filters_el","checked_callback","category","el","className","classList","checkbox","type","addEventListener","event","target","indeterminate","checked","label","createTextNode","get_active_filters","version_filters_els","filters","elements","include","exclude","pass","fail","e","idx","arr","partition","min_ver","max_ver","search_results","current_ac","current_updating_event","fix_hostname","original_url","is_legacy_cf","url","URL","hostname","toString","populate_results","results_el","results","settings","hidden_authors","length","result","every","split","latestFilesIndexes","some","file","gameVersion","authors","author","toLowerCase","filter_results","window","location","search","li","title","title_link","href","links","websiteUrl","use_legacy_cf","author_link","subtitle","downloads","number","downloadCount","toFixed","updated","Date","dateModified","toLocaleDateString","created","dateCreated","summary","category_el","category_img","src","iconUrl","download","get_download_url","download_button","logo","thumbnailUrl","alt","is_mod","get","is_modpack","subver","Number","modloader","is_old_forge","file_id","modLoader","fileId","TypeError","isNaN","gameVersionTypeId","refresh_results","setTimeout","API_PARAM_MAP","Map","LEGACY_PARAM_MAP","k","update_query_params","params2","set","join","delete","history","pushState","by_id","getElementById","bind","search_form","classes_el","categories_el","modloader_el","version_el","sub_version_el","sort_field_el","sort_order_el","page_size_el","reset_button","page_els","getElementsByClassName","loading_indicator","sidebar_el","show_filters","show_id","on_change","toggled","toggle","show_author","_value","this","trim","page","should_update","update_results","event_name","FormData","hidden","query_result","form_data","page_size","alert","abort","AbortController","queries","offset","real_page_size","Math","min","index","signal","query_results","query","flat","error","fetch_results","new_params","to_api_params","populate_filters","sub_versions","cache_time","localStorage","getItem","now","Promise","all","setItem","JSON","stringify","parse","fetch_dropdown_values","prefill_forms","load_query_params","control","page_el","disabled","category_dropdown_values","update_result_filters","val","subvers","endsWith","sort_subvers","reset_form","setting","input","replace","reportValidity","reset_page","state","validity","preventDefault","pathname","page_el2","form"],"sourceRoot":""}