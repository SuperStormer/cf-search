(()=>{"use strict";const e="$2a$10$3kFa9lBWciEK.lsp7NyCSupZ3XmlAYixZQ9fTczqsz1/.W9QDnLUy",t=432,a=[["Any",0],["Fabric",4],["NeoForge",6],["Forge",1],["Quilt",5]],n=[["Popularity",2],["Total Downloads",6],["Last Updated",3],["Date Created",11],["Name",4],["Author",5],["Featured",1]],l=["asc","desc"].map((e=>[e,e])),r={classId:"6",modLoaderType:"0",sortField:"6",sortOrder:"desc",pageSize:"50"};function o(e,t){return e.reduce((function(e,a){return(e[a[t]]=e[a[t]]||[]).push(a),e}),{})}function s(e,t){const a=new Set;return e.filter((function(e){return!a.has(e[t])&&(a.add(e[t]),!0)}))}function i(e,t){return e.localeCompare(t,"en",{numeric:!0})}function c(e,t){let a=o(e,"parentCategoryId"),n=a[t];delete a[t],n.sort(((e,t)=>i(e.name,t.name)));for(let[e,t]of Object.entries(a)){e=parseInt(e,10),t.sort(((e,t)=>i(e.name,t.name))),t.forEach((e=>{e._is_sub_category=!0}));let a=n.findIndex((t=>t.id===e));n.splice(a+1,0,...t)}return n}async function d(t,a,n){return"object"!=typeof a||a instanceof URLSearchParams?null==a&&(a=""):a=new URLSearchParams(a),t.startsWith("/")&&(t=t.slice(1)),fetch("https://api.curseforge.com/"+t+"?"+a,{headers:{"x-api-key":e,accept:"application/json"},...n}).then((e=>e.json())).then((e=>e.data))}function u(e,t,a){e.innerHTML="";let n=document.createDocumentFragment();for(let[e,a]of t){let t=document.createElement("option");t.value=a,t.textContent=e,n.append(t)}if(e.append(n),null==a){let t=document.createElement("option");t.value="",t.selected=!0,t.textContent=e.dataset.name,e.dataset.default="",e.prepend(t)}else{Array.from(e.options).find((e=>e.value===a)).selected=!0,e.dataset.default=a,e.dispatchEvent(new Event("change"))}}async function m(){let e=await d("/v1/categories",{gameId:t});e=o(e,"classId");let a=function(e){let t=e.findIndex((e=>"Mods"===e.name)),a=e.splice(t,1)[0],n=e.findIndex((e=>"Modpacks"===e.name));return[a,e.splice(n,1)[0]].concat(e.sort(((e,t)=>i(e.name,t.name))))}(e[void 0]);delete e[void 0];for(let t in e)e[t]=c(e[t],t);let n=[5192,4780,5190,5129];return e[6]=e[6].filter((e=>!n.includes(e.id))),[a,e]}async function f(){return function(e){return e.sort(((e,t)=>-i(e.name,t.name)))}((await d(`/v1/games/${t}/version-types`)).filter((e=>e.name.startsWith("Minecraft ")&&"Minecraft Beta"!==e.name)).map((e=>({...e,name:e.name.slice(10)}))))}function p(e,t,a){e.innerHTML="";let n=document.createDocumentFragment();for(let e of t){let t=document.createElement("label");t.className="checkbox-label",e._is_sub_category&&t.classList.add("checkbox-label-nested");let l=document.createElement("input");l.type="checkbox",l.name=e.name,l.value=e.id,l.addEventListener("change",(function(e){let t=e.target;t.dataset.value&&"off"!==t.dataset.value?"include"===t.dataset.value?(t.indeterminate=!0,t.checked=!0,t.dataset.value="exclude"):(t.checked=!1,t.indeterminate=!1,t.dataset.value="off"):(t.checked=!0,t.indeterminate=!1,t.dataset.value="include"),a()}));let r=document.createTextNode(e.name);t.append(l,r),n.append(t)}e.append(n)}function g(e,t){let a=Array.from(e.elements).filter((e=>e.checked)),[n,l]=function(e,t){let a=[],n=[];return e.forEach(((e,l,r)=>(t(e,l,r)?a:n).push(e))),[a,n]}(a,(e=>"include"===e.dataset.value));[n,l]=[n.map((e=>parseInt(e.value,10))),l.map((e=>parseInt(e.value,10)))];let[r,o]=Array.from(t).map((e=>e.value));return{include:n,exclude:l,max_ver:o,min_ver:r}}let h=[],v=null,y="";function w(e,t){let a=new URL(e);return a.hostname=t?"legacy.curseforge.com":"www.curseforge.com",a.toString()}function _(e,t,a,n){a=function(e,t,a){let{include:n,exclude:l,max_ver:r,min_ver:o}=t;return n.length>0&&(e=e.filter((e=>n.every((t=>e.categories.find((e=>e.id===t))))))),l.length>0&&(e=e.filter((e=>e.categories.every((e=>!l.includes(e.id)))))),r.length>0&&(2===r.split(".").length&&(r+="a"),e=e.filter((e=>e.latestFilesIndexes.some((e=>i(e.gameVersion,r)<=0))))),o.length>0&&(e=e.filter((e=>e.latestFilesIndexes.some((e=>i(e.gameVersion,o)>=0))))),a.length>0&&(e=e.filter((e=>!e.authors.some((e=>a.includes(e.name.toLowerCase())))))),e}(a,t,n.hidden_authors.value);let l=new URLSearchParams(window.location.search),r=document.createDocumentFragment();for(let e of a){let t=document.createElement("li");t.className="result";let a=document.createElement("div");a.className="result-title";let i=document.createElement("a");if(i.className="result-title-link",i.href=w(e.links.websiteUrl,n.use_legacy_cf.value),i.textContent=e.name,a.append(i),e.authors.length>0){let t=document.createElement("span");t.className="result-author";let l=document.createElement("a");l.className="result-author-link",l.href=w(e.authors[0].url,n.use_legacy_cf.value),l.textContent=e.authors[0].name,t.append("by",l),a.append(t)}let c=document.createElement("div");c.className="result-subtitle";let d=document.createElement("span");d.textContent=`${o=e.downloadCount,o<1e3?o.toString():o<1e6?(o/1e3).toFixed(1)+"K":(o/1e3/1e3).toFixed(1)+"M"} Downloads`;let u=document.createElement("span");u.textContent=`Updated ${new Date(e.dateModified).toLocaleDateString()}`;let m=document.createElement("span");m.textContent=`Created ${new Date(e.dateCreated).toLocaleDateString()}`,c.append(d,u,m);let f=document.createElement("p");f.className="result-summary",f.textContent=e.summary;let p=document.createElement("div");p.className="result-categories";for(let t of s(e.categories,"id")){let e=document.createElement("a");e.href=w(t.url,n.use_legacy_cf.value);let a=document.createElement("img");a.className="result-category-image",a.src=t.iconUrl,a.title=t.name,e.append(a),p.append(e)}let g=document.createElement("span");g.className="result-project-id",g.textContent=`Project ID: ${e.id}`;let h=document.createElement("a");h.className="download-button",h.href=w(x(e,l),n.use_legacy_cf.value);let v=document.createElement("button");v.textContent="Download",h.append(v);let y=document.createElement("img");y.className="result-logo",e.logo&&(y.src=e.logo.thumbnailUrl||e.logo.url),y.alt="",t.append(y,p,h,g,a,c,f),r.append(t)}var o;e.append(r)}function x(e,t){let a="6"===t.get("classId"),n="4471"===t.get("classId"),l=t.get("gameVersion"),r=Number.parseInt(t.get("gameVersionTypeId"),10),o=Number.parseInt(t.get("modLoaderType"),10);if(a&&t.get("gameVersion")&&t.has("modLoaderType")&&"0"!==t.get("modLoaderType")){let t=i(l,"1.14")<0&&1===o;try{let a=e.latestFilesIndexes.find((e=>e.gameVersion===l&&(e.modLoader===o||null==e.modLoader&&t))).fileId;return`${e.links.websiteUrl}/download/${a}/file`}catch(e){TypeError}}else if(n)try{let t=e.latestFilesIndexes.find((e=>(Number.isNaN(r)||e.gameVersionTypeId===r)&&(!l||e.gameVersion===l))).fileId;return`${e.links.websiteUrl}/download/${t}/file`}catch(e){TypeError}else if(!a&&!n&&t.get("gameVersion"))try{let t=e.latestFilesIndexes.find((e=>e.gameVersion===l)).fileId;return`${e.links.websiteUrl}/download/${t}/file`}catch(e){TypeError}return`${e.links.websiteUrl}/files/all`}function E(e,t,a){setTimeout((()=>{e.innerHTML="",_(e,t,h,a)}),0)}const I=new Map([["class","classId"],["category","categoryId"],["version","gameVersionTypeId"],["sub_version","gameVersion"],["modloader","modLoaderType"],["sort_field","sortField"],["sort_order","sortOrder"],["search","searchFilter"],["page_size","pageSize"]]),L=new Map([...I.entries().map((([e,t])=>[t,e])),["filtersInclude","include_filters"],["filtersExclude","exclude_filters"],["maxVer","max_ver"],["minVer","min_ver"]]);function b(e,t){let a=new URLSearchParams(e),{include:n,exclude:l,max_ver:o,min_ver:s}=t;a.set("filtersInclude",n.join(" ")),a.set("filtersExclude",l.join(" ")),a.set("maxVer",o),a.set("minVer",s);for(let[e,t]of Array.from(a.entries()))(e in r&&t===r[e]||""===t)&&a.delete(e);window.location.search!=="?"+a.toString()&&history.pushState({},"","?"+a.toString())}!async function(){const e=document.getElementById.bind(document),o=e("search-form"),s=e("classes"),c=e("categories"),w=e("modloader"),x=e("version"),S=e("sub-version"),N=e("sort-field"),k=e("sort-order"),C=e("page-size"),T=e("reset"),V=document.getElementsByClassName("page"),F=e("loading-indicator"),U=e("results"),D=e("sidebar"),M=e("filters"),$=document.getElementsByClassName("version-filter"),P=e("show-filters"),A={show_id:{value:!1,on_change(e){U.classList.toggle("show-id",e)}},show_author:{value:!1,on_change(e){U.classList.toggle("show-author",e)}},use_legacy_cf:{value:!1,on_change(){let e=g(M,$);E(U,e,A)}},hidden_authors:{_value:[],set value(e){this._value=e.split(",").map((e=>e.trim().toLowerCase()))},get value(){return this._value},on_change(){let e=g(M,$);E(U,e,A)}}};let R=0,j=!1;async function z(e){let a=new FormData(o),n=g(M,$);"control_change"===e&&b(a,n),F.hidden=!1,U.innerHTML="";for await(let l of async function*(e,a,n){let l=new URLSearchParams(e),r=Number.parseInt(l.get("pageSize"),10);if(r*(a+1)>1e4)alert("The desired page is too large for the Curseforge API");else{null!==v&&v.abort(),v=new AbortController,y=n,l.append("gameId",t),"0"===l.get("modLoaderType")&&l.delete("modLoaderType"),h=[];try{let e=[];for(let t=0;t<r;t+=50){let n=Math.min(50,r-t),o=new URLSearchParams(l),s=r*a+t;o.set("index",s),o.set("pageSize",n),o.get("gameVersion")&&o.delete("gameVersionTypeId"),e.push(d("/v1/mods/search",o,{signal:v.signal}))}let t=[];for(let a of e){let e=(await a).filter((e=>e.classId===parseInt(l.get("classId"),10)));yield e,t.push(e)}h=t.flat(),v=null,y=null}catch(e){if("AbortError"!==e.name)throw e}}}(function(e){let t=new URLSearchParams;for(let[a,n]of e.entries())t.append(I.get(a)||a,n);return t}(a),R,e))_(U,n,l,A);F.hidden=!0}const W=p.bind(p,M);let[O,B,H,Q]=await async function(){let e,a,n,l,r=localStorage.getItem("cache_time"),o=Date.now();if(!r||o-r>864e5){let r=await Promise.all([m(),f(),d(`/v1/games/${t}/versions`)]);[[e,a],n,l]=r,localStorage.setItem("cache",JSON.stringify(r)),localStorage.setItem("cache_time",o)}else[[e,a],n,l]=JSON.parse(localStorage.getItem("cache"));return[e,a,n,l]}();function J(){j=!1;const e=function(){let e=new URLSearchParams(window.location.search),t=new Map;for(let[a,n]of e)t.set(L.get(a)||a,n);return t}();for(let t of o.elements)e.has(t.name)&&(t.value=e.get(t.name),t.dispatchEvent(new Event("change")));if(e.has("page"))for(let t of V)t.value=e.get("page");if(e.has("include_filters")){let t=e.get("include_filters").split(" ");for(let e of M.elements)t.includes(e.value)&&(e.checked=!0,e.dataset.value="include")}if(e.has("exclude_filters")){let t=e.get("exclude_filters").split(" ");for(let e of M.elements)t.includes(e.value)&&(e.indeterminate=!0,e.checked=!0,e.dataset.value="exclude")}e.has("min_version")&&($[0].value=e.get("min_version")),e.has("max_version")&&($[1].value=e.get("max_version")),j=!0}u(c,[]),s.addEventListener("change",(function(){["Mods","Modpacks","Worlds"].includes(O.find((e=>e.id===parseInt(s.value,10))).name)?(w.title="",w.disabled=!1):(w.title=w.dataset.title,w.disabled=!0);let e=s.value,t=B[e].map((e=>[e._is_sub_category?" └ "+e.name:e.name,e.id]));u(c,t),W(B[e],K)})),u(s,O.map((e=>[e.name,e.id])),r.classId),u(w,a,r.modLoaderType),u(x,H.map((e=>[e.name,e.id]))),u(S,[]),x.addEventListener("change",(function(){let e=x.value;if(""===e)return void u(S,[]);let t=Number.parseInt(e,10),a=function(e){return e.sort(((e,t)=>e.endsWith("Snapshot")?1:t.endsWith("Snapshot")?-1:-i(e,t)))}(Q.find((e=>e.type===t)).versions);u(S,a.map((e=>[e,e])))})),u(N,n,r.sortField),u(k,l,r.sortOrder),J(),window.addEventListener("popstate",(function(){q(),J(),z("popstate")}));for(let t in A){let a=e(t.replace(/_/g,"-"));"checkbox"===a.type?a.checked="true"===localStorage.getItem(t):a.value=localStorage.getItem(t);let n=function(){let e="checkbox"===a.type?a.checked:a.value;localStorage.setItem(t,e),A[t].value=e,A[t].on_change(A[t].value)};a.addEventListener("change",n),n()}function K(){let e=g(M,$);b(window.location.search,e),E(U,e,A)}for(let e of $)e.addEventListener("change",(function(){e.reportValidity()&&K()}));function Z(){R=0;for(let e of V)e.value=1}function q(){for(let e of o.elements)void 0!==e.dataset.default?e.value=e.dataset.default:"text"===e.type&&(e.value="");for(let e of M.elements)e.dataset.value="off",e.checked=!1,e.indeterminate=!1;for(let e of $)e.value="";for(let e of V)e.value=1}P.addEventListener("click",(function(){D.classList.toggle("show-filters")?P.textContent="Hide":P.textContent="Show"})),C.addEventListener("invalid",(function(e){let t=e.target;for(let e in t.validity)if("stepMismatch"!==e&&t.validity[e])return;e.preventDefault(),Z(),z("control_change")})),T.addEventListener("click",(function(e){e.preventDefault(),history.pushState({},"",window.location.pathname),q(),z("reset")})),o.addEventListener("submit",(function(e){e.preventDefault(),"control_change"!==y&&(Z(),z("form_submit"))}));for(let e of V)e.addEventListener("change",(function(t){if(!e.reportValidity())return;R=Number.parseInt(t.target.value,10)-1;for(let e of V)e.value=R+1;let a=new URLSearchParams(window.location.search);a.set("page",R+1),history.pushState({},"","?"+a),z("page_change")}));for(let e of o.elements)"submit"!==e.type&&e.addEventListener("change",(function(e){e.target.form.reportValidity()&&j&&(Z(),z("control_change"))}));z("default"),j=!0}()})();
//# sourceMappingURL=index.js.map